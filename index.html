<!DOCTYPE html>
<html lang="es">
<head>
  <title>three.js webgl - instancing test (trees)</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>
<body>

  <div id="container"></div>

  <script src="js/three/three.min.js"></script>
  <script src="js/l2t/l2t.js"></script>

  <script src="js/controls/TrackballControls.js"></script>

  <script>

    var container;

    var camera, scene, renderer;

    var controls;

    var shaderMaterial;
    var instancedGeometry = new L2TGeometry();
    instancedGeometry.loadData( 'images/densidad.bin', 'images/arbolado.bin' );
    instancedGeometry.loadModel( 'arbol.json', init );

    function init() {

      container = document.getElementById( 'container' );

      camera = new THREE.PerspectiveCamera( 50, window.innerWidth / window.innerHeight, 0.01, 10000 );
      camera.position.z = 4000;

      scene = new THREE.Scene();
      scene.add( new THREE.AmbientLight( 0xffffff, 0.3 ) );
      const light = new THREE.DirectionalLight( 0xffffff, 0.7 );
      light.position.set( 0.3, -.2, .4 ).normalize();
      scene.add( light );

      var instancedMesh = new THREE.Mesh( instancedGeometry, shaderMaterial );
      instancedMesh.castShadow = true;
      instancedMesh.receiveShadow = true;
      scene.add( instancedMesh );

      // PLANO 

      var planeGeometry = new THREE.PlaneGeometry( 2000, 2000, 79, 79 );
      var planeMaterial = new THREE.MeshLambertMaterial( { wireframe: true } );

      var mdt = new THREE.TextureLoader().load('images/mdt.png');

      var plane = new THREE.Mesh( planeGeometry, planeMaterial );
      plane.castShadow = true;
      plane.receiveShadow = true;
      scene.add( plane );

      renderer = new THREE.WebGLRenderer();
      renderer.setPixelRatio( window.devicePixelRatio );
      renderer.setSize( window.innerWidth, window.innerHeight );
      container.appendChild( renderer.domElement );

      controls = new THREE.TrackballControls( camera, renderer.domElement );
      controls.addEventListener( 'change', render );

      if ( renderer.extensions.get( 'ANGLE_instanced_arrays' ) === null ) {

        document.getElementById( 'notSupported' ).style.display = '';
        return;

      }

      window.addEventListener( 'resize', onWindowResize, false );
      render();

    }

    function onWindowResize() {

      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();

      renderer.setSize( window.innerWidth, window.innerHeight );

    }

    //

    function render() {

      renderer.render( scene, camera );

    }

  </script>

</body>

</html>
